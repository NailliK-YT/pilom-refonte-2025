class RegistrationForm{constructor(e){this.step=e,this.debounceTimers={},this.autoSaveInterval=null}init(){1===this.step?this.initStep1():2===this.step?this.initStep2():3===this.step&&this.initStep3(),this.startAutoSave()}initStep1(){const e=document.getElementById("email"),t=document.getElementById("password"),s=document.getElementById("password_confirm");e&&(e.addEventListener("blur",()=>this.validateEmail()),e.addEventListener("input",()=>{this.debounce("email",()=>this.validateEmail(),500)})),t&&t.addEventListener("input",()=>{this.validatePassword(),s.value&&this.validatePasswordConfirm()}),s&&s.addEventListener("input",()=>{this.validatePasswordConfirm()})}async validateEmail(){const e=document.getElementById("email"),t=document.getElementById("emailValidation");if(!e||!t)return;const s=e.value.trim();if(!s)return t.textContent="",void e.classList.remove("error","success");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return t.textContent="Format d'email invalide",t.className="validation-message error",e.classList.add("error"),void e.classList.remove("success");try{const a=await fetch("/register/validate-email",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`email=${encodeURIComponent(s)}`}),o=await a.json();o.valid?(t.textContent="✓ "+o.message,t.className="validation-message success",e.classList.remove("error"),e.classList.add("success")):(t.textContent=o.message,t.className="validation-message error",e.classList.add("error"),e.classList.remove("success"))}catch(e){console.error("Email validation error:",e)}}async validatePassword(){const e=document.getElementById("password"),t=document.getElementById("strengthFill"),s=document.getElementById("strengthText");if(!e||!t||!s)return;const a=e.value;if(!a)return t.style.width="0%",t.className="strength-fill",void(s.textContent="");try{const o=await fetch("/register/validate-password",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`password=${encodeURIComponent(a)}`}),n=await o.json();t.style.width=n.strength+"%",n.strength<50?(t.className="strength-fill weak",s.textContent="Faible - "+n.messages.join(", "),e.classList.add("error"),e.classList.remove("success")):n.strength<100?(t.className="strength-fill medium",s.textContent="Moyen - Ajoutez: "+n.messages.join(", "),e.classList.remove("error","success")):(t.className="strength-fill strong",s.textContent="Fort",e.classList.remove("error"),e.classList.add("success"))}catch(e){console.error("Password validation error:",e)}}validatePasswordConfirm(){const e=document.getElementById("password"),t=document.getElementById("password_confirm"),s=document.getElementById("passwordConfirmValidation");if(!e||!t||!s)return;const a=e.value,o=t.value;if(!o)return s.textContent="",void t.classList.remove("error","success");a===o?(s.textContent="✓ Les mots de passe correspondent",s.className="validation-message success",t.classList.remove("error"),t.classList.add("success")):(s.textContent="Les mots de passe ne correspondent pas",s.className="validation-message error",t.classList.add("error"),t.classList.remove("success"))}initStep2(){}initStep3(){const e=document.getElementById("step3Form"),t=e?.querySelector('button[type="submit"]');e&&t&&e.addEventListener("submit",e=>{t.classList.add("loading"),t.disabled=!0})}startAutoSave(){this.autoSaveInterval=setInterval(()=>{this.saveProgress()},3e4)}stopAutoSave(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval)}async saveProgress(){const e=this.collectFormData();if(e&&0!==Object.keys(e).length)try{const t=await fetch("/register/save-progress",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`step=${this.step}&data=${encodeURIComponent(JSON.stringify(e))}`}),s=await t.json();s.success&&console.log("Progress saved:",s.message)}catch(e){console.error("Auto-save error:",e)}}collectFormData(){const e={};if(1===this.step){const t=document.getElementById("email")?.value,s=document.getElementById("company_name")?.value,a=document.getElementById("password")?.value;t&&(e.email=t),s&&(e.company_name=s),a&&(e.password=a)}else if(2===this.step){const t=document.getElementById("selectedSector")?.value;t&&(e.business_sector_id=t)}return e}debounce(e,t,s){this.debounceTimers[e]&&clearTimeout(this.debounceTimers[e]),this.debounceTimers[e]=setTimeout(()=>{t(),delete this.debounceTimers[e]},s)}}window.addEventListener("beforeunload",()=>{window.registrationForm&&window.registrationForm.stopAutoSave()});