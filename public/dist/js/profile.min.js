const BASE_URL=window.location.origin+"/";function initPhotoUpload(){const e=document.getElementById("photoUpload"),t=document.getElementById("profilePhotoPreview"),n=document.getElementById("deletePhoto");e&&e.addEventListener("change",function(e){const n=e.target.files[0];if(!n)return;if(!n.type.match("image.*"))return void alert("Veuillez sélectionner une image.");if(n.size>2097152)return void alert("La taille de l'image ne doit pas dépasser 2MB.");const o=new FileReader;o.onload=function(e){t&&(t.src=e.target.result)},o.readAsDataURL(n),uploadPhoto(n)}),n&&n.addEventListener("click",function(){confirm("Voulez-vous vraiment supprimer votre photo de profil ?")&&fetch(BASE_URL+"profile/delete-photo",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?location.reload():alert(e.error||"Erreur lors de la suppression.")}).catch(e=>{console.error("Error:",e),alert("Erreur de connexion.")})})}function uploadPhoto(e){const t=new FormData;t.append("photo",e),fetch(BASE_URL+"profile/upload-photo",{method:"POST",body:t,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?(showMessage("Photo mise à jour avec succès !","success"),setTimeout(()=>location.reload(),1e3)):alert(e.error||"Erreur lors du téléchargement.")}).catch(e=>{console.error("Error:",e),alert("Erreur de connexion.")})}function initPasswordStrength(){const e=document.getElementById("new_password"),t=document.getElementById("confirm_password"),n=document.getElementById("strengthFill"),o=document.getElementById("strengthText");e&&e.addEventListener("input",function(){const e=this.value,t=calculatePasswordStrength(e);n&&o&&(n.className="strength-fill "+t.class,o.textContent=t.text),updatePasswordRequirements(e)}),t&&e&&t.addEventListener("input",function(){const t=document.getElementById("confirmMessage");this.value&&this.value!==e.value?(t.textContent="Les mots de passe ne correspondent pas.",t.style.color="#dc2626"):this.value===e.value?(t.textContent="Les mots de passe correspondent.",t.style.color="#16a34a"):t.textContent=""})}function calculatePasswordStrength(e){let t=0;return e.length>=8&&t++,e.length>=12&&t++,/[a-z]/.test(e)&&t++,/[A-Z]/.test(e)&&t++,/[0-9]/.test(e)&&t++,/[^a-zA-Z0-9]/.test(e)&&t++,t<=2?{class:"weak",text:"Faible"}:t<=4?{class:"medium",text:"Moyen"}:{class:"strong",text:"Fort"}}function updatePasswordRequirements(e){const t={"req-length":e.length>=8,"req-uppercase":/[A-Z]/.test(e),"req-lowercase":/[a-z]/.test(e),"req-number":/[0-9]/.test(e)};for(const[e,n]of Object.entries(t)){const t=document.getElementById(e);if(t){const e=t.querySelector(".req-icon");n?(e.textContent="✓",e.classList.add("valid"),e.style.color="#16a34a"):(e.textContent="⚪",e.classList.remove("valid"),e.style.color="#ccc")}}}function initFormValidation(){document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",function(e){})});const e=document.getElementById("siret");e&&e.addEventListener("input",function(){this.value=this.value.replace(/\D/g,"")});document.querySelectorAll('input[type="tel"]').forEach(e=>{e.addEventListener("blur",function(){this.value=formatPhoneNumber(this.value)})});const t=document.getElementById("iban");t&&t.addEventListener("input",function(){this.value=this.value.toUpperCase().replace(/[^A-Z0-9]/g,"")})}function formatPhoneNumber(e){const t=e.replace(/\D/g,"");return 10===t.length?t.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4 $5"):e}function initAutoSave(){}function showMessage(e,t="info"){const n=document.createElement("div");n.className=`alert alert-${t}`,n.textContent=e;const o=document.querySelector(".profile-content, .settings-content");o&&(o.insertBefore(n,o.firstChild),setTimeout(()=>n.remove(),5e3))}document.addEventListener("DOMContentLoaded",function(){initPhotoUpload(),initPasswordStrength(),initFormValidation(),initAutoSave()});